<!doctype html>
<html>

    <head>
        <meta charset="utf-8">
        <title>Tree Chart</title>
        <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    </head>

    <body>
        <div id="chart" style="width: 50%; height: 900px;"></div>
        <script>
            const container = document.getElementById('chart');
            const chart = echarts.init(container);


            // basic option skeleton for a tree
            const option = {
                tooltip: {
                    trigger: 'item',
                    triggerOn: 'mousemove'
                },
                series: [
                    {
                        type: 'tree',
                        data: [], // filled after loading
                        top: '5%',
                        left: '5%',
                        bottom: '5%',
                        right: '20%',
                        symbol: 'circle',
                        symbolSize: 6,
                        edgeShape: 'polyline',
                        edgeForkPosition: '20%',
                        //orient: 'vertical', // or 'horizontal'
                        orient: 'horizontal',

                        nodeGap: 10,   // default suele ser más grande, probá con 10-20
                        // distancia vertical mínima entre hermanos
                        layerPadding: 30, // si tu versión de echarts lo soporta

                        expandAndCollapse: true,
                        initialTreeDepth: 3,
                        label: {
                            position: 'left',
                            verticalAlign: 'middle',
                            align: 'right',
                            fontSize: 12,
                            formatter: params => {
                                return params.data.title
                            }
                        },
                        leaves: {
                            label: {
                                position: 'right',
                                verticalAlign: 'middle',
                                align: 'left'
                            }
                        },
                        emphasis: {
                            focus: 'descendant'
                        },
                        itemStyle: {
                            borderColor: '#555'
                        },
                        lineStyle: {
                            color: '#aaa'
                        }
                    }
                ]
            };


            chart.setOption(option);


            // fetch the data from the Flask endpoint
            fetch('/data')
                .then(resp => {
                    if (!resp.ok) throw new Error('Failed to load /data: ' + resp.status);
                    return resp.json();
                })
                .then(treeData => {
                    // Put the loaded data into the series
                    chart.setOption({
                        series: [{
                            data: treeData
                        }]
                    });
                })
                .catch(err => {
                    console.error(err);
                    container.innerText = 'Could not load tree data: ' + err.message;
                });


            // make the chart responsive
            window.addEventListener('resize', () => chart.resize());
        </script>
    </body>

</html>